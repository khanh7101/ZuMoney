import {useContext,useEffect,useState} from 'react'
import {useRouter} from 'next/router'
import {supabase} from '../src/lib/supabaseClient'
import {AuthContext} from '../src/context/AuthContext'
export default function LoginPage(){const[email,setEmail]=useState('');const[msg,setMsg]=useState<string|null>(null);const[error,setError]=useState<string|null>(null);const session=useContext(AuthContext);const router=useRouter();useEffect(()=>{if(session)router.replace('/')},[session,router]);const sendMagic=async(e:React.FormEvent)=>{e.preventDefault();setMsg(null);setError(null);const redirectTo=typeof window!=='undefined'?window.location.origin:undefined;const {error}=await supabase.auth.signInWithOtp({email,options:{emailRedirectTo:redirectTo}});if(error)setError(error.message);else setMsg('Đã gửi link đăng nhập. Hãy kiểm tra email của bạn!')};return(<div className='min-h-screen flex items-center justify-center'><form onSubmit={sendMagic} className='card w-full max-w-md'><h1 className='text-2xl font-bold mb-2'>ZuMoney</h1><p className='text-sm text-[var(--muted)] mb-4'>Sign in via magic link</p><input className='w-full p-3 rounded mb-3' type='email' placeholder='you@email.com' value={email} onChange={e=>setEmail(e.target.value)} required/><button className='btn w-full' type='submit'>Send magic link</button>{msg&&<p className='text-emerald-400 text-sm mt-3'>{msg}</p>}{error&&<p className='text-red-400 text-sm mt-3'>{error}</p>}</form></div>) }
